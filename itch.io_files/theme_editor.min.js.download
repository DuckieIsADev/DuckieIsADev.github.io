(()=>{var O=window.I,C=window.React,W=window.ReactDOM,E=window.ReactDOMFactories,Y=window.ReactTransitionGroup,k=window.PropTypes,j=window.classNames,w=window.R;C||O.libs.react.done(function(){return C=window.React,W=window.ReactDOM,E=window.ReactDOMFactories,Y=window.ReactTransitionGroup,k=window.PropTypes,j=window.classNames,w=window.R});var M=function(o){return O.libs.react.done(o)},J=null;M(function(){var o,r;return o=E,r=o.img,J=function(i){var l,b,n,s,c;return i==null&&(i={}),c=(b=i.width)!=null?b:24,l=(n=i.height)!=null?n:c,C.createElement("svg",{className:"svgicon icon_close",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:(s=i.stroke_width)!=null?s:"2",width:c,height:l,strokeLinejoin:"round","aria-hidden":!0,fill:"none"},C.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),C.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},J=C.createElement.bind(null,C.memo(J))});var Q=null,_t=null,U=null;M(function(){var o,r,i,l,b,n,s,c;return o=E,r=o.a,b=o.div,i=o.button,s=o.label,n=o.h2,c=o.p,l=null,U=function(m){return m.promise?(I.Lightbox.open_loading(),m.then(function(d){return function(u){return I.Lightbox.open(u)}}(this),function(d){return function(u){return I.Lightbox.open(_t({errors:u.errors}))}}(this))):I.Lightbox.open(m)},Q=w.component("Lightbox",{is_modal_dialog:function(){var m;return m=document.getElementById("lightbox_container"),m!=null?m.contains(this.container_ref.current):void 0},getInitialState:function(){return{}},componentDidMount:function(){if(this.is_modal_dialog())return l?console.warn("A dialog already has the focus trap"):(this.detect_focus=function(m){return function(d){var u;if(u=m.container_ref.current,u&&"contains"in u&&!(u===d.target||u.contains(d.target)))return u.focus()}}(this),$(document.body).on("focusin",this.detect_focus),l=this),this.setState({previously_focused:document.activeElement,is_modal_dialog:!0},function(){return _.defer(function(m){return function(){var d;return(d=m.container_ref.current)!=null?d.focus():void 0}}(this))})},componentWillUnmount:function(){var m;return this.detect_focus&&($(document.body).off("focusin",this.detect_focus),l=null,delete this.detect_focus),(m=this.state.previously_focused)!=null?m.focus():void 0},close:function(){return I.Lightbox.close()},render:function(){return b({className:classNames("lightbox",this.props.className),style:this.props.style,role:this.state.is_modal_dialog?"dialog":void 0,"aria-modal":this.state.is_modal_dialog?"true":void 0,tabIndex:this.state.is_modal_dialog?-1:void 0,ref:this.container_ref||(this.container_ref=React.createRef())},this.props.close!==!1?i({className:"close_button",type:"button","aria-label":"Close Dialog"},J({width:18})):void 0,this.props.children)}}),_t=w.component("ErrorLightbox",{propTypes:{title:k.string,errors:k.array.isRequired},render:function(){return Q({className:classNames(this.enclosing_class_name(),"compact")},n({},this.props.title||this.tt("misc.lightboxes.error_title")),w.Forms.FormErrors({title:!1,errors:this.props.errors}),c({className:"buttons"},i({className:"button",type:"button",onClick:function(m){return function(){return I.Lightbox.close()}}(this)},"Close")))}})});var nt=null;M(function(){var o,r,i,l,b,n,s;return r=E,b=r.h2,n=r.p,s=r.strong,i=r.a,l=r.button,o=w.package("ThemeEditor"),nt=o("CSSInstructionsLightbox",{render:function(){return w.Lightbox({ref:this.lightbox_ref||(this.lightbox_ref=C.createRef()),className:"css_instructions_lightbox_widget"},b({},"Custom CSS"),n({},"Keep in mind we sometimes upgrade itch.io's pages and it's difficult to ensure those changes don't conflict with custom layouts people have done with the CSS editor. ",s({},"Enhancing existing components instead of trying to redo the entire page is the best way to avoid any problems. ")),n({},"Please read the ",i({href:this.props.css_guide_url,target:"_blank"},"Custom CSS guide")," before using any custom CSS."),n({},"If there's a customization you think that we should include as part of the theme editor then ",i({href:"/support",target:"_blank"},"send us a message"),"."),n({},l({type:"button",className:"button",onClick:function(c){return function(){var m;return(m=c.lightbox_ref.current)!=null?m.close():void 0}}(this)},"Got it")))}})});var ft=null;M(function(){var o,r,i,l,b,n,s,c,m;return r=E,n=r.h2,c=r.p,b=r.fragment,i=r.a,l=r.div,s=r.input,m=r.textarea,b=C.createElement.bind(null,C.Fragment),b.type=C.fragment,o=w.package("ThemeEditor"),ft=o("CssEditorLightbox",{pure:!0,render:function(){return Q({ref:this.lightbox_ref||(this.lightbox_ref=C.createRef()),className:classNames(this.enclosing_class_name(),"compact")},n({},"Edit CSS"),c({},"Changes are automatically applied.",this.props.css_guide_url?b({}," ",i({href:this.props.css_guide_url,target:"_blank",onClick:function(d){return function(u){return u.preventDefault(),U(nt({css_guide_url:d.props.css_guide_url}))}}(this)},"Info about CSS on itch.io.")):void 0),l({className:"input_wrapper"},m({defaultValue:this.props.default_value,onChange:this.props.on_change,placeholder:"Type CSS here"})))}})});var kt=[].slice,rt=null;M(function(){var o,r,i,l,b;return r=E,l=r.h2,b=r.p,i=r.button,o=w.package("ThemeEditor"),rt=o("ErrorLightbox",{propTypes:{title:k.string,errors:k.array.isRequired},render:function(){return Q.apply(null,[{ref:this.lighbox_ref||(this.lighbox_ref=C.createRef()),className:"game_edit_error_lightbox_widget compact"},l({},this.props.title||"We encountered an error")].concat(kt.call(this.props.errors.map(function(n){return function(s){return b({},s)}}(this))),[b({className:"sub_text"},this.props.sub_text)],[b({className:"buttons"},i({className:"button",type:"button",onClick:function(n){return function(){var s;return(s=n.lighbox_ref.current)!=null?s.close():void 0}}(this)},"Close"))]))}})});var Z,H,st,ot,it,at,V,dt,lt,tt,ut,ct,et,mt,gt,pt,wt=[].slice;tt=function(o,r,i){return o<0?o+=1:o>1&&(o-=1),6*o<1?r+(i-r)*6*o:2*o<1?i:3*o<2?r+(i-r)*(2/3-o)*6:r},st=function(o,r,i){var l,b,n,s,c;return o=o/360,r=r/100,i=i/100,r===0?(n=i,b=i,l=i):(c=i<.5?i*(1+r):i+r-i*r,s=2*i-c,n=tt(o+1/3,s,c),b=tt(o,s,c),l=tt(o-1/3,s,c)),[n*255,b*255,l*255]},ut=function(o,r,i){var l,b,n,s,c;return o=o/255,r=r/255,i=i/255,s=Math.min(o,r,i),n=Math.max(o,r,i),c=0,l=0,b=(s+n)/2,s!==n&&(c=b<.5?(n-s)/(n+s):(n-s)/(2-n-s),l=function(){switch(n){case o:return(r-i)/(n-s);case r:return 2+(i-o)/(n-s);case i:return 4+(o-r)/(n-s)}}()),l<0&&(l+=6),[l*60,c*100,b*100]},at=function(){var o,r,i,l,b,n,s,c,m,d,u;if(d=arguments[0],c=2<=arguments.length?wt.call(arguments,1):[],l="[a-fA-f0-9]",b=l+l,u="^#("+l+")("+l+")("+l+")$",m="^#("+b+")("+b+")("+b+")$",n=d.match(new RegExp(u)),n)o=n[0],s=n[1],i=n[2],r=n[3],s+=s,i+=i,r+=r;else{if(n=d.match(new RegExp(m)),!n)return null;o=n[0],s=n[1],i=n[2],r=n[3]}return[parseInt(s,16),parseInt(i,16),parseInt(r,16)]},V=function(){var o;return o=at.apply(null,arguments),o||[0,0,0]},Z=function(o){var r;return r=Math.floor(o).toString(16),r.length===1?"0"+r:r},H=function(o,r,i){return o=Math.min(255,Math.max(0,o)),r=Math.min(255,Math.max(0,r)),i=Math.min(255,Math.max(0,i)),"#"+Z(o)+Z(r)+Z(i)},mt=function(o,r,i){var l,b,n,s,c;return r==null&&(r=15),i==null&&(i=.8),s=ut.apply(null,V(o)),l=s[0],c=s[1],b=s[2],n=b>50?b-r:b+r,n=Math.max(0,Math.min(100,n)),H.apply(null,st(l,c*i,n))},ot=function(o,r,i){return(.299*o+.587*r+.114*i)/255},lt=function(o,r,i){return o=o/255,r=r/255,i=i/255,o=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),i=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*o+.7152*r+.0722*i},ct=function(o,r,i){var l,b,n;return n=.299*o+.587*r+.114*i,l=(i-n)*.565,b=(o-n)*.713,[n,l,b]},pt=function(o,r,i){var l,b,n;return n=o+1.403*i,b=o-.344*r-.714*i,l=o+1.77*r,[n,b,l]},et=function(o,r,i,l){var b,n,s,c;return l==null&&(l=.1),b=ct(o,r,i),c=b[0],n=b[1],s=b[2],l<0?c+=l*c:c+=l*(255-c),pt(c,n,s)},dt=function(o,r,i){var l,b;return typeof o=="string"&&(l=V(o),o=l[0],r=l[1],i=l[2]),b=lt(o,r,i),b>=.45?it(H(o,r,i),"#000000",.2):"#ffffff"},gt=function(o,r,i){var l,b,n,s,c;return r==null&&(r=.15),i==null&&(i=.5),c=V(o),s=c[0],b=c[1],l=c[2],n=ot(s,b,l),n<i?H.apply(null,et(s,b,l,r)):H.apply(null,et(s,b,l,-r))},it=function(o,r,i){var l,b,n,s,c,m,d,u,f;return i===1?o:i===0?r:(u=V(o),m=u[0],s=u[1],b=u[2],f=V(r),d=f[0],c=f[1],n=f[2],l=1-i,H(m*i+d*l,s*i+c*l,b*i+n*l))};var S=O.Color||(O.Color={hsl_to_rgb:st,rgb_to_hsl:ut,parse_color:at,parse_color_safe:V,hex_color:H,sub_color:mt,luma:ot,relative_luma:lt,rgb_to_yuv:ct,yuv_to_rgb:pt,scale_luma:et,readable_text_color:dt,sub_color2:gt,mix_color:it}),Nt=[].slice,ht=O.theme_template_scope||(O.theme_template_scope={first:function(o,r,i,l){var b,n;return(b=(n=o!=null?o:r)!=null?n:i)!=null?b:Nt.call(arguments).find(function(s){return function(c){return c!=null}}(this))},when:function(o,r,i,l){return o===r?i:l},sub_color2:S.sub_color2,sub_color:S.sub_color,mix_color:S.mix_color,alpha:function(o,r){var i,l,b,n;return n=S.parse_color_safe(o),b=n[0],l=n[1],i=n[2],"rgba("+b+", "+l+", "+i+", "+r+")"},bg_color_for_input:function(o){var r,i,l;return r=S.sub_color2(o,.1),i=S.luma.apply(S,S.parse_color_safe(o)),l=Math.min(1,Math.max(0,(i-.5)*2)),S.mix_color("#ffffff",r,l)},text_color_for_bg:function(o){return S.readable_text_color(o)},text_shadow_color_for_bg:function(o){var r;return r=S.relative_luma.apply(S,S.parse_color_safe(o)),r>=.45?"transparent":S.sub_color2(o)}}),vt=null,G=null;M(function(){var o,r,i,l,b;return r=E,l=r.div,i=r.button,b=r.input,o=w.package("Forms"),o("PortalElement",{getInitialState:function(){return this.el=document.createElement("div"),$(this.el).addClass("portal_element"),{}},componentDidMount:function(){return this.props.container_el.appendChild(this.el)},componentWillUnmount:function(){return this.props.container_el.removeChild(this.el)},render:function(){return W.createPortal(this.props.children,this.el)}}),vt=o("ColorWheel",{render:function(){var n,s,c,m,d,u,f,h,v;return(m=this.state)!=null&&m.color&&!this.props.onChange?(d=this.state.color,n=d[0],f=d[1],s=d[2]):this.props.color&&(u=this.props.color,n=u[0],f=u[1],s=u[2]),n==null&&(n=0),f==null&&(f=50),s==null&&(s=100),c=(n-90)/180*Math.PI,h=Math.cos(c),v=Math.sin(c),this.enclose({},l({className:"color_block",style:{background:"hsl("+n+", 100%, 50%)",width:"101px",height:"101px"}}),l({className:"wheel",style:{width:"195px",height:"195px"},onMouseDown:function(a){return function(t){return t.preventDefault(),a.start_drag(t,t.target,function(e,p){var g,y;return h=(e-.5)*2,v=(p-.5)*2,g=Math.atan2(v,h)/Math.PI*180,y=(g+360+90)%360,a.update_color(y,f,s)})}}(this)}),l({className:"mask",style:{width:"101px",height:"101px"},onMouseDown:function(a){return function(t){return t.preventDefault(),a.start_drag(t,t.target,function(e,p){var g,y;return y=(1-e)*100,g=(1-p)*100,a.update_color(n,y,g)})}}(this)}),l({className:"marker h-marker",style:{left:97+h*84+"px",top:97+v*84+"px"}}),l({className:"marker sl-marker",style:{left:47+101*(100-f)/100+"px",top:47+101*(100-s)/100+"px"}}))},set_hex_color:function(n){var s,c,m,d;try{return d=S.parse_color(n),m=d[0],c=d[1],s=d[2],this.setState({color:S.rgb_to_hsl(m,c,s)})}catch(u){}},update_color:function(n,s,c){return this.props.onChange!=null?this.props.onChange([n,s,c]):this.setState({color:[n,s,c]})},start_drag:function(n,s,c){var m,d,u;if(!((d=this.state)!=null&&d.dragging))return this.setState({dragging:!0}),m=function(f){var h,v,a,t,e;if(f.preventDefault(),f.buttons===0){u();return}return a=s.getBoundingClientRect(),t=f.clientX,e=f.clientY,h=(t-a.left)/(a.right-a.left),v=(e-a.top)/(a.bottom-a.top),h=Math.min(1,Math.max(0,h)),v=Math.min(1,Math.max(0,v)),typeof c=="function"?c(h,v):void 0},u=function(f){return function(h){return h!=null&&h.preventDefault(),document.body.removeEventListener("mousemove",m),document.body.removeEventListener("mouseup",u),delete f.up_listener,f.setState({dragging:!1})}}(this),document.body.addEventListener("mousemove",m),document.body.addEventListener("mouseup",u),m(n),this.up_listener=u}}),o("ColorInputPopup",{palette:["#193d3f","#3f2832","#743f39","#9e2835","#b86f50","#327345","#e53b44","#4f6781","#0484d1","#fb922b","#afbfd2","#63c64d","#e4a672","#2ce8f4","#ffe762"],set_wheel_color:function(n){var s,c,m,d;try{return d=S.parse_color(n),m=d[0],c=d[1],s=d[2],this.setState({wheel_color:S.rgb_to_hsl(m,c,s)})}catch(u){}},componentDidMount:function(){var n;if(!((n=this.state)!=null&&n.wheel_color)&&this.props.color)return this.set_wheel_color(this.props.color)},render:function(){var n,s,c,m;return this.wheel_ref||(this.wheel_ref=C.createRef()),n=this.props.palette||this.palette,(s=this.props.position)&&(m={left:s.left+"px",top:s.top+"px"}),this.enclose({className:"color_popout",style:m},this.props.allow_empty&&this.props.color?i({type:"button",className:"clear_color_btn",onClick:function(d){return function(){var u;return typeof(u=d.props).set_color=="function"?u.set_color(""):void 0}}(this)},"Clear"):void 0,vt({ref:this.wheel_ref,color:(c=this.state)!=null?c.wheel_color:void 0,onChange:function(d){return function(u){var f;return typeof(f=d.props).set_color=="function"&&f.set_color(S.hex_color.apply(S,S.hsl_to_rgb.apply(S,u))),d.setState({wheel_color:u})}}(this)}),n?l({className:"palette_options"},n.map(function(d){return function(u){return i({key:u,type:"button",style:{backgroundColor:u},onClick:function(f){var h;return typeof(h=d.props).set_color=="function"&&h.set_color(u),d.set_wheel_color(u)}},u)}}(this))):void 0)}}),G=o("ColorInput",{pure:!0,propTypes:{name:k.string,value:k.any,defaultValue:k.any,allow_empty:k.bool,popout_portal_target:k.object},componentDidMount:function(){return G.active_inputs||(G.active_inputs=[]),G.active_inputs.push(this)},componentWillUnmount:function(){var n;return G.active_inputs=function(){var s,c,m,d;for(m=G.active_inputs,d=[],s=0,c=m.length;s<c;s++)n=m[s],n!==this&&d.push(n);return d}.call(this)},componentDidUpdate:function(n,s){var c,m,d;if(m=n.value||"",d=this.props.value||"",m!==d&&(c=this.set_color(d)))return this.refs.input.value=c},getInitialState:function(){return{open:!1,last_value:this.props.value||this.props.defaultValue||""}},on_blur:function(){if(!this.set_color_from_input())return this.input_ref.current.value=this.state.last_value,this.set_color(this.state.last_value)},set_color_from_input:function(){var n,s,c;return s=this.input_ref.current.value,s===""&&this.props.allow_empty?(this.setState({has_error:!1,last_value:""}),!0):(s!==""&&!s.match("^#")&&(s="#"+s,this.input_ref.current.value=s),n=S.parse_color(s),n?(this.set_color(s),(c=this.popout_ref.current)!=null&&c.set_wheel_color(s),!0):(this.setState({has_error:!0}),!1))},set_color:function(n){var s;return this.input_ref.current.value=n,this.setState({last_value:n,has_error:!1}),typeof(s=this.props).onChange=="function"?s.onChange(n):void 0},open:function(){if(!this.state.open)return this.setState({open:!0,on_left:this.popout_on_left(),popout_position:this.popout_position()}),this.click_outside_handler||(this.click_outside_handler=function(n){return function(s){var c,m,d;if(d=W.findDOMNode(n),!$(s.target).closest(d).length&&!((m=n.popout_ref.current)&&(c=W.findDOMNode(m),$(s.target).closest(c).length)))return n.close()}}(this)),$(document.body).on("mousedown",this.click_outside_handler)},componentWillUnmount:function(){if(this.click_outside_handler)return $(document.body).off("mousedown",this.click_outside_handler)},close:function(){if(this.state.open)return this.setState({open:!1}),$("document.body").off("mousedown",this.click_outside_handler)},popout_position:function(){var n,s;if(this.props.popout_portal_target)return n=W.findDOMNode(this),s=n.getBoundingClientRect(),{left:Math.trunc(s.right+window.scrollX),top:Math.trunc(s.top+window.scrollY)}},popout_on_left:function(){var n,s;return n=$(W.findDOMNode(this)),s=n.offset().left+n.width()+250,s>$(window).width()+$(window).scrollLeft()},render_color_popout:function(){var n,s;return this.popout_ref||(this.popout_ref=C.createRef()),s=o.ColorInputPopup({ref:this.popout_ref,palette:this.props.palette,color:this.state.last_value,allow_empty:this.props.allow_empty,set_color:this.set_color,position:this.state.popout_position}),(n=this.props.popout_portal_target)&&(s=o.PortalElement({container_el:n},s)),s},render:function(){var n;return n=this.state.last_value||"#ffffff",this.input_ref||(this.input_ref=C.createRef()),this.enclose({className:j(this.props.className,{picker_open:this.state.open,picker_left:this.state.on_left,color_error:this.state.has_error})},b({ref:this.input_ref,type:"text",className:"color_text_input",name:this.props.name,defaultValue:this.props.value||this.props.defaultValue,placeholder:this.props.defaultValue||"Color",onBlur:this.on_blur,onFocus:this.open,onKeyDown:function(s){return function(c){switch(c.keyCode){case 9:return s.close()}}}(this),onKeyUp:function(s){return function(c){return s.set_color_from_input()}}(this)}),l({className:"color_swatch",onClick:this.open,style:{backgroundColor:n}}),this.state.open?this.render_color_popout():void 0)}})});var X=null;M(function(){var o,r,i,l,b,n;return r=E,b=r.input,n=r.p,l=r.div,i=r.button,o=w.package("Forms"),X=o("Slider",{pure:!0,propTypes:{min:k.number,max:k.number,value:k.number,onChange:k.func,disabled:k.bool},getInitialState:function(){return{}},on_change:function(s){return s=Math.round(s),this.props.onChange?this.props.value===s?void 0:this.props.onChange(s):this.state.value===s?void 0:this.setState({value:s})},start_drag:function(s,c){var m,d,u,f;if(!this.props.disabled)return f=this.track_ref.current.clientWidth,d=this.current_value(),this.setState({dragging:!0}),m=function(h){return function(v){var a,t,e,p;if(v.preventDefault(),v.buttons===0){u();return}if(e=v.pageX,p=v.pageX,a=e-s,t=a/f*(h.props.max-h.props.min)+d,t=Math.min(h.props.max,Math.max(h.props.min,t)),t!==h.current_value())return h.on_change(t)}}(this),u=function(h){return function(v){return v!=null&&v.preventDefault(),h.setState({dragging:!1}),document.body.removeEventListener("mousemove",m),document.body.removeEventListener("mouseup",u),delete h.up_listener}}(this),document.body.addEventListener("mousemove",m),document.body.addEventListener("mouseup",u),this.up_listener=u},current_value:function(){return"value"in this.state?this.state.value||this.props.min:this.props.value||this.props.min},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener)return this.up_listener()},render:function(){var s;return s={left:this.percent()*100+"%"},this.enclose({className:j("slider_input",{disabled:this.props.disabled}),onClick:function(c){return function(m){var d,u;if(!c.props.disabled&&m.target!==c.slider_nub_ref.current&&(u=c.track_ref.current.getBoundingClientRect(),n=Math.min(u.width,Math.max(0,m.pageX-u.left))/u.width,d=c.props.min+n*(c.props.max-c.props.min),d=Math.min(c.props.max,Math.max(c.props.min,d)),d!==c.current_value()))return c.on_change(d)}}(this)},this.props.name?b({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,l({ref:this.track_ref||(this.track_ref=C.createRef()),className:"slider_track"},l({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?l({style:s,className:"value_tooltip"},this.current_value()):void 0,i({type:"button",ref:this.slider_nub_ref||(this.slider_nub_ref=C.createRef()),className:j("slider_nub",{disabled:this.props.disabled}),onFocus:function(c){return function(){return c.setState({focused:!0})}}(this),onBlur:function(c){return function(){return c.setState({focused:!1})}}(this),onMouseDown:function(c){return function(m){return c.start_drag(m.pageX,m.pageY)}}(this),onKeyDown:function(c){return function(m){switch(m.keyCode){case 37:c.on_change(Math.max(c.props.min,c.current_value()-1));break;case 39:c.on_change(Math.min(c.props.max,c.current_value()+1));break;default:return}return m.preventDefault()}}(this),style:s})))}})});var q=null;M(function(){var o,r,i,l,b,n,s,c,m,d;return r=E,s=r.img,m=r.label,l=r.button,i=r.a,d=r.pre,c=r.input,n=r.div,o=w.package("Forms"),b=0,o("ImagePreview",{pure:!0,getInitialState:function(){return{loaded:!1}},render:function(){return s({className:j(this.enclosing_class_name(),this.props.className,{image_loading:!this.state.loaded}),src:this.props.src,onLoad:function(u){return function(){var f;return u.setState({loaded:!0}),typeof(f=u.props).on_load=="function"?f.on_load():void 0}}(this)})}}),o("VideoPreview",{pure:!0,render:function(){return C.createElement("video",{width:200,loop:!0,muted:!0,autoPlay:!0,src:this.props.src})}}),q=o("ImageUploader",{pure:!0,propTypes:{upload_url:k.string.isRequired,name:k.string.isRequired,thumb_size:k.string,label:k.string,upload:k.object,show_replace:k.bool},getDefaultProps:function(){return{remove_button_classes:["button","outline","small"],replace_button_classes:["button","outline","small"],upload_button_classes:"button"}},getInitialState:function(){return{active_uploads:[],uploads:this.props.upload?[this.props.upload]:this.props.uploads}},push_errors:function(u){var f,h,v,a;return typeof u=="string"&&(u=[u]),h=function(){var t,e,p;for(p=[],t=0,e=u.length;t<e;t++)if(f=u[t],typeof f=="string")p.push(f);else if(Array.isArray(f))a=f[0],v=f[1],v?p.push(v.name+" - "+a):p.push(a);else continue;return p}(),this.setState(function(t){return{errors:(t.errors||[]).concat(h)}})},get_progress:function(){return Math.min.apply(Math,this.state.active_uploads.map(function(u){return function(f){return f.progress}}(this)))},pick_image:function(u){return this.setState({errors:[]}),O.upload_image({url:this.props.upload_url,accept:this.props.accept,thumb_size:this.props.thumb_size,multiple:this.props.multiple,max_size:this.props.max_size,test_file:function(f){return function(h,v){return $.when(O.test_image_dimensions(h),O.test_image_format(h)).done(function(){return v.resolve()}).fail(function(a){return v.reject(a)})}}(this),on_start_upload:function(f){return function(h,v,a){var t;return t={file:h,upload:v,xhr:a,progress:0},f.setState(function(e){return{active_uploads:e.active_uploads.concat([t]),uploading:!0}}),a.progress(function(e,p,g){var y;return y=Object.assign({},t,{progress:p/g}),f.setState(function(x){return{active_uploads:x.active_uploads.map(function(N){return function(z){return z===t?y:z}}(this))}}),t=y}).done(function(e){var p;if(e.errors){f.push_errors(e.errors);return}if(v=e.upload,typeof u=="function"&&u(),v)return typeof(p=f.props).on_upload=="function"&&p.on_upload(v),f.setState(function(g){return{uploads:(g.uploads||[]).concat([v])}})}).always(function(){return f.setState(function(e){var p;return p=e.active_uploads.filter(function(g){return function(y){return y!==t}}(this)),{uploading:!!p.length,active_uploads:p}})})}}(this)}).fail(function(f){return function(h){return f.push_errors(h)}}(this))},remove_image:function(u){var f,h;if(h=this.state.uploads[u],this.setState(function(v){var a;return{uploads:function(){var t,e,p,g;for(p=this.state.uploads,g=[],t=0,e=p.length;t<e;t++)a=p[t],a!==h&&g.push(a);return g}.call(this)}}),!this.props.multiple)return typeof(f=this.props).on_upload=="function"?f.on_upload(null):void 0},render_existing_upload:function(u,f){var h;return h=this.props.multiple?this.props.name+"["+(f+1)+"]":this.props.name,n({className:"existing_upload",key:u.id},c({type:"hidden",name:h,value:u.id}),u.thumb_url?n({className:"preview_image"},u.thumb_url.match(/\.mp4$/)?o.VideoPreview({src:u.thumb_url}):o.ImagePreview({src:u.thumb_url})):void 0,this.props.children,n({className:"existing_upload_tools"},this.props.show_replace?l({className:j("replace_image_btn",this.props.replace_button_classes),type:"button",onClick:function(v){return function(a){return a.preventDefault(),v.pick_image(function(){return v.remove_image(f)})}}(this)},"Replace image"):void 0,l({className:j("remove_image_btn",this.props.remove_button_classes),type:"button",onClick:function(v){return function(a){return a.preventDefault(),v.remove_image(f)}}(this)},"Remove image")))},render:function(){var u,f,h,v,a,t;return this.autogen_id="image-uploader-"+b++,u=!!((f=this.state.uploads)!=null&&f.length),this.enclose({className:j(this.props.className,{no_upload:!u,have_upload:!!u})},this.props.label?m({className:"label",htmlFor:this.autogen_id},this.props.label):void 0,(h=this.state.errors)!=null&&h.length?w.Forms.FormErrors({errors:this.state.errors,title:"Upload failed"}):void 0,this.props.multiple||(v=this.state.uploads)!=null&&v.length?void 0:c({type:"hidden",name:this.props.name,value:""}),this.state.uploading?n({className:"upload_progress"},this.state.active_uploads.length?"Uploading "+((this.get_progress()||0)*100).toFixed(2)+"%":"Uploading..."):void 0,this.props.multiple||!((a=this.state.uploads)!=null&&a.length)?l({id:this.autogen_id,disabled:!!this.state.uploading,className:j(this.props.upload_button_classes,{small:this.props.compact,disabled:!!this.state.uploading}),type:"button",onClick:function(e){return function(p){return p.preventDefault(),e.pick_image()}}(this)},this.props.upload_label||(this.props.multiple?"Upload images":"Upload image")):void 0,(t=this.state.uploads)!=null&&t.length?n({className:"existing_uploads",children:this.state.uploads.map(this.render_existing_upload)}):void 0)}})});var K=[].slice;M(function(){var o,r,i,l,b,n,s,c,m,d,u,f,h,v,a;return l=E,u=l.input,b=l.a,n=l.button,d=l.img,c=l.form,a=l.span,h=l.section,s=l.div,m=l.h3,f=l.label,v=l.select,i=Y.TransitionGroup,o=Y.CSSTransition,r=w.package("GameEdit"),r("ThemeEditor",{getInitialState:function(){return $.extend({open:this.props.open||!1,fonts:this.props.fonts,css_template:this.props.css_template?window.eval(this.props.css_template):void 0},this.props.theme)},render_to_css:function(){var t,e,p,g,y,x,N,z,L,B,F,T,A;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}return A=this.state.background_image?(t=function(){switch(this.state.background_position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}.call(this),_.compact(["background-image: url('"+this.state.background_image.thumb_url+"')","background-repeat: "+(this.state.background_repeat||"repeat"),"background-position: "+t,this.state.background_attach==="fixed"?"background-attachment: fixed":void 0]).join(";")):"",x=this.state.embed_background_image?(p=["url('"+this.state.embed_background_image.thumb_url+"')"],(g=this.state.embed_background_color1)&&(y=(L=this.state.embed_background_color2)!=null?L:g,e=((B=this.state.embed_background_alpha)!=null?B:50)/100,F=ht.alpha,p.unshift("linear-gradient(to bottom, "+F(g,e)+", "+F(y,e)+")")),_.compact(["background-image: "+p.join(",")+";"])):"",N=this.state.fonts.find(function(P){return function(D){return D.slug===P.state.font_family}}(this)),z=this.state.fonts.find(function(P){return function(D){return D.slug===P.state.header_font_family}}(this)),T=$.extend(Object.create(ht),{wrapper_background_css:A,embed_background_css:x,font_family:w.ThemeEditor.escape_font_family((N!=null?N.family:void 0)||"inherit"),header_font_family:w.ThemeEditor.escape_font_family((z!=null?z.family:void 0)||"inherit"),header_text_color:this.state.header_text_color||"inherit"},_.pick.apply(_,[this.state].concat(K.call(["bg_color","bg2_color","text_color","link_color","button_color","header_text_color","screenshots_loc","default_screenshots_loc","bg2_alpha"])))),T=new Proxy(T,{has:function(P){return function(){return!0}}(this)}),this.state.css_template(T)},render_banner:function(){var t,e;if(this._header||(this._header=$("#header")),this._header.removeClass().addClass("header"),t=this.state.banner_image,t)return e=this.state.banner_position||"align_center",d=this._header.find("img"),this._header.addClass("has_image").addClass(e),d.exists()?d.attr("src",t.thumb_url):$("<img src='"+t.thumb_url+"'/>").appendTo(this._header)},load_font:function(t){var e;if(this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts)),!this.loaded_fonts[t]&&(this.loaded_fonts[t]=!0,e=this.state.fonts.find(function(p){return p.slug===t}),!!e&&e.href&&!$("link[data-font='"+e.slug+"']").exists()))return $("<link rel='stylesheet' href='"+e.href+"' data-font='"+e.slug+"'></link>").appendTo("head")},apply_css:function(){var t;return this.style_el||(this.style_el=$("#game_theme").exists()||$("<style type='text/css' id='game_theme'></style>").appendTo($("head"))),this.style_el[0].innerHTML=I.strip_css(this.render_to_css()||""),this.props.can_use_css&&(this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head"))),this.custom_style_el[0].innerHTML=I.strip_css(this.state.css||"")),this.render_banner(),this.load_font(this.state.font_family),this.load_font(this.state.header_font_family),t=classNames(["inner_column",this.state.font_family?"family_"+this.state.font_family:void 0,this.state.font_size?"size_"+this.state.font_size:void 0]),$("#inner_column").removeClass().addClass(t)},componentDidUpdate:function(t,e){return this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100)),this.apply_css_throttled()},save:function(){return this.setState({loading:!0}),I.remote_submit($(this.refs.form)).then(function(t){return function(e){if(t.setState({loading:!1}),e.errors)return U(w.ThemeEditor.ErrorLightbox({errors:e.errors,sub_text:"Your changes were not saved, please try again"}))}}(this))},render:function(){return React.createElement(i,{key:"transition_group",component:"span"},this.state.open?React.createElement(o,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({className:"theme_editor_widget",key:"real"},c({ref:"form",method:"POST",action:this.props.submit_url,onSubmit:function(t){return function(e){return e.preventDefault(),t.save()}}(this)},w.CSRF({}),h.apply(null,[{className:"input_group"}].concat(K.call(this.render_color_pickers()))),h.apply(null,[{className:"input_group"}].concat(K.call(this.render_font_pickers()))),h.apply(null,[{className:"input_group"}].concat(K.call(this.render_layout_options()))),this.render_image_uploaders(),this.render_css_editor(),s({className:"buttons save_buttons"},n({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||!1},this.state.loading&&"Saving..."||"Save"))))},append_font:function(t){return this.setState({fonts:K.call(this.state.fonts).concat([t])})},render_font_pickers:function(){var t;return[m({},"Text"),f({className:"horiz_input"},a({className:"label_text"},"Font"),w.ThemeEditor.FontSelect({name:"layout[font_family]",value:this.state.font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_font_family||(this.set_font_family=function(e){return function(p){return e.setState({font_family:p})}}(this))})),f({className:"horiz_input"},a({className:"label_text"},"Size"),w.Forms.SimpleSelect({name:"layout[font_size]",value:this.state.font_size,onChange:this.set_font_size||(this.set_font_size=function(e){return function(p){return e.setState({font_size:p})}}(this)),options:this.font_size_options||(this.font_size_options=[{name:"Small",value:"small"},{name:"Medium",value:"medium"},{name:"Large",value:"large"},{name:"Very Large",value:"very_large"}])})),w.ThemeEditor.MoreGroup({label:"More options...",ref:"more_font_options",default_open:!!((t=this.props.theme)!=null&&t.header_font_family)},f({className:"horiz_input"},a({className:"label_text"},"Header font"),w.ThemeEditor.FontSelect({name:"layout[header_font_family]",allow_default:!0,value:this.state.header_font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_header_font_family||(this.set_header_font_family=function(e){return function(p){return e.setState({header_font_family:p})}}(this))})))]},render_align_select:function(t,e){var p;return f({className:"horiz_input"},a({className:"label_text"},"Align"),w.Forms.SimpleSelect({name:t,value:this.state[e],onChange:this[p="set_"+e]||(this[p]=function(g){return function(y){var x;return x={},x[e]=y,g.setState(x)}}(this)),options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])}))},render_image_uploaders:function(){var t;return h({className:"input_group"},m({},"Images"),q({compact:!0,upload_url:this.props.image_upload_url,max_size:this.props.image_size_limit,upload:this.state.banner_image,name:"layout[banner_image][image_id]",label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(e){return function(p){return e.setState({banner_image:p})}}(this))},this.state.banner_image?s({className:"position_fields"},this.render_align_select("layout[banner_image][position]","banner_position")):void 0),q({compact:!0,upload_url:this.props.image_upload_url,max_size:this.props.image_size_limit,upload:this.state.background_image,name:"layout[background_image][image_id]",label:"Background",upload_label:"Upload",on_upload:this.set_background_image||(this.set_background_image=function(e){return function(p){return e.setState({background_image:p})}}(this))},this.state.background_image?s({className:"position_fields"},f({className:"horiz_input"},a({className:"label_text"},"Repeat"),w.Forms.SimpleSelect({name:"layout[background_image][repeat]",value:this.state.background_repeat,onChange:this.set_background_repeat||(this.set_background_repeat=function(e){return function(p){return e.setState({background_repeat:p})}}(this)),options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),this.render_align_select("layout[background_image][position]","background_position"),f({className:"horiz_input"},a({className:"label_text"},"Fixed"),s({},u({type:"checkbox",name:"layout[background_image][attach]",value:"fixed",checked:this.state.background_attach==="fixed",onChange:this.set_background_attach||(this.set_background_attach=function(e){return function(p){return e.setState({background_attach:p.target.checked?"fixed":null})}}(this))})))):void 0),this.props.game_type==="html"||this.state.embed_background_image?q({compact:!0,upload_url:this.props.image_upload_url,max_size:this.props.image_size_limit,name:"layout[embed_background_image][image_id]",label:"Embed BG",upload_label:"Upload",upload:this.state.embed_background_image,on_upload:function(e){return function(p){return e.setState({embed_background_image:p})}}(this)},s({className:"color_options"},f({className:"horiz_input"},a({className:"label_text"},"Color 1"),this.color_input("embed_background_color1",{name:"layout[embed_background_image][color1]"})),f({className:"horiz_input"},a({className:"label_text"},"Color 2"),this.color_input("embed_background_color2",{name:"layout[embed_background_image][color2]",allow_empty:!0})),f({className:"horiz_input"},a({className:"label_text"},"Alpha"),X({min:0,max:100,show_tooltip:!0,value:(t=this.state.embed_background_alpha)!=null?t:50,name:"layout[embed_background_image][alpha]",onChange:this.set_embed_background_alpha||(this.set_embed_background_alpha=function(e){return function(p){return e.setState({embed_background_alpha:p})}}(this))})))):void 0)},color_input:function(t,e){var p,g;return e==null&&(e={}),G({name:(g=e.name)!=null?g:"layout["+t+"]",popout_portal_target:document.body,className:"compact",value:this.state[t],allow_empty:e.allow_empty,onChange:this[p="set_"+t]||(this[p]=function(y){return function(x){var N;return x===""&&(x=void 0),N={},N[t]=x,y.setState(N)}}(this))})},render_color_pickers:function(){var t,e,p,g;return[m({},"Color"),f({className:"horiz_input"},a({className:"label_text"},"BG"),this.color_input("bg_color")),f({className:"horiz_input"},a({className:"label_text"},"BG 2"),this.color_input("bg2_color")),f({className:"horiz_input"},a({className:"label_text"},"Text"),this.color_input("text_color")),f({className:"horiz_input"},a({className:"label_text"},"Link"),this.color_input("link_color")),w.ThemeEditor.MoreGroup({label:"More options...",ref:"more_color_options",default_open:((t=this.props.theme)!=null?t.header_text_color:void 0)||((e=this.props.theme)!=null?e.button_color:void 0)||((p=this.props.theme)!=null?p.bg2_alpha:void 0)!=null},f({className:"horiz_input"},a({className:"label_text"},"Headers"),this.color_input("header_text_color",{allow_empty:!0})),f({className:"horiz_input"},a({className:"label_text"},"Buttons"),this.color_input("button_color",{allow_empty:!0})),f({className:"horiz_input"},a({className:"label_text"},"BG2 Alpha"),X({min:0,max:100,show_tooltip:!0,value:(g=this.state.bg2_alpha)!=null?g:100,name:"layout[bg2_alpha]",onChange:this.set_bg2_alpha||(this.set_bg2_alpha=function(y){return function(x){return y.setState({bg2_alpha:x})}}(this))})))]},render_css_editor:function(){if(this.props.can_use_css)return h({className:"input_group css_editor"},m({},"Misc"),w.ThemeEditor.CssEditor({name:"layout[css]",value:this.state.css,css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(t){return function(e){return t.setState({css:e.target.value})}}(this))}))},render_layout_options:function(){return[m({},"Layout"),f({className:"horiz_input"},a({className:"label_text"},"Screenshots"),w.Forms.SimpleSelect({name:"layout[screenshots_loc]",value:this.state.screenshots_loc||"",onChange:this.setup_screenshots_loc||(this.setup_screenshots_loc=function(t){return function(e){return e||(e=void 0),t.setState({screenshots_loc:e})}}(this)),options:this.screenshots_loc_options||(this.screenshots_loc_options=[{name:"Auto ("+this.state.default_screenshots_loc+")",short_name:"Auto",value:""},{name:"Sidebar",value:"sidebar"},{name:"Hidden",value:"hidden"}])}))]}})}),M(function(){var o,r,i,l,b,n,s,c,m;return i=E,s=i.img,c=i.input,n=i.div,m=i.span,b=i.button,l=i.a,r=w.package("ThemeEditor"),o=function(d){var u,f,h,v;return d==null&&(d={}),v=(f=d.width)!=null?f:18,u=(h=d.height)!=null?h:16,React.createElement("svg",{className:"svgicon icon_grab",fill:"currentColor",stroke:"none",role:"img",version:"1.1",viewBox:"0 0 18 16",width:v,height:u,"aria-hidden":!0},React.createElement("rect",{width:"18",height:"4"}),React.createElement("rect",{y:"12",width:"18",height:"4"}),React.createElement("rect",{y:"6",width:"18",height:"4"}))},o=React.createElement.bind(null,React.memo(o)),r("OrderPickerItem",{pure:!0,propTypes:{item:k.shape({id:k.number,order:k.number,name:k.string,hidden:k.bool,type:k.string},{position:k.number,input_name:k.string})},input_name:function(d){return this.props.input_name+"["+(this.props.position+1)+"]["+d+"]"},render:function(){var d;return d=this.props.item,n({"data-id":d.id,className:classNames("order_row",{dragging:this.props.dragging})},this.props.input_name?c({type:"hidden",className:"position_input",name:this.input_name("id"),value:d.id}):void 0,this.props.item.hidden&&this.props.input_name?c({type:"hidden",name:this.input_name("hidden"),value:"1"}):void 0,o({}),m({className:"item_name",title:d.name},d.name),b({type:"button",className:classNames("hide_btn",{is_active:this.props.item.hidden}),onClick:function(u){return function(f){return f.preventDefault(),u.trigger("order_picker_item:hidden",u.props.item,!u.props.item.hidden)}}(this)},this.props.item.hidden?"Hidden":"Hide"))}}),r("OrderPicker",{pure:!0,propTypes:{input_name:k.string,update_order:k.func,items:k.arrayOf(k.shape({id:k.number,name:k.string,hidden:k.bool,type:k.string}))},getInitialState:function(){return{items:this.props.items}},update_order:function(d){var u,f,h,v,a,t,e;for(v={},e=this.state.items,a=0,t=e.length;a<t;a++)f=e[a],v[""+f.id]=f;return h=d.map(function(p){return function(g){return v[g]}}(this)),this.setState({items:h}),typeof(u=this.props).update_order=="function"?u.update_order(h):void 0},componentDidMount:function(){var d;return d=$(this.list_ref.current),this.dispatch("order_picker_item",{hidden:function(u){return function(f,h,v){var a,t;return t=u.state.items.map(function(e){return h.id===e.id?$.extend({},h,{hidden:v}):e}),u.setState({items:t}),typeof(a=u.props).update_order=="function"?a.update_order(t):void 0}}(this)}),window.requestAnimationFrame(function(u){return function(){return d.sortable({cancel:"button"}).on("sortstop",function(f){var h;return h=d.sortable("toArray",{attribute:"data-id"}),d.sortable("cancel"),u.update_order(h)})}}(this))},render:function(){return this.enclose({ref:this.list_ref||(this.list_ref=React.createRef()),className:"sorting_picker"},this.state.items.map(function(d){return function(u,f){return w.ThemeEditor.OrderPickerItem({key:u.id,position:f,item:u,input_name:d.props.input_name})}}(this)))}})});var bt=[].slice,yt=[].indexOf||function(o){for(var r=0,i=this.length;r<i;r++)if(r in this&&this[r]===o)return r;return-1};M(function(){var o,r,i,l,b,n,s,c,m,d,u,f,h,v;return l=E,d=l.input,b=l.a,v=l.span,f=l.p,c=l.form,s=l.div,n=l.button,h=l.section,m=l.h3,u=l.label,r=w.package("Profile"),i=Y.TransitionGroup,o=Y.CSSTransition,r("ThemeEditor",{getInitialState:function(){return{open:!1,fonts:this.props.fonts,css_template:this.props.css_template?window.eval(this.props.css_template):void 0,theme:this.props.theme,banner_image:this.props.banner_image,background_image:this.props.background_image}},update_theme:function(a,t){var e;if(this.state.theme[a]!==t)return e={},e[a]=t,this.setState({theme:Object.assign({},this.state.theme,e)})},componentDidUpdate:function(a,t){if(this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100)),this.apply_css_throttled(),(t.theme.game_order!==this.state.theme.game_order||t.theme.hidden_games!==this.state.theme.hidden_games)&&this.apply_project_order(),t.theme.collection_order!==this.state.theme.collection_order||t.theme.hidden_collections!==this.state.theme.hidden_collections)return this.apply_collection_order()},render_to_css:function(){var a,t,e,p,g;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}return t=this.state.fonts.find(function(y){return function(x){return x.slug===y.state.theme.font_family}}(this)),a=w.ThemeEditor.background_css(this.state.background_image,this.state.theme.background_image),g=Object.assign(Object.create(ht),{font_size:((e=this.state.theme.font_size)!=null?e:100)+"%",font_family:w.ThemeEditor.escape_font_family((t!=null?t.family:void 0)||"inherit"),background_image_css:a,border_radius:this.state.theme.border_radius?this.state.theme.border_radius+"px":void 0,header_image_css:((p=this.state.theme.banner_image)!=null?p.size:void 0)==="full"?"width: 100%;":void 0},_.pick.apply(_,[this.state.theme].concat(bt.call(["bg_color","text_color","link_color"])))),g=new Proxy(g,{has:function(y){return function(){return!0}}(this)}),this.state.css_template(g)},apply_css:function(){var a,t;return this.style_el||(this.style_el=$("#user_theme").exists()||$("<style type='text/css' id='user_theme'></style>").appendTo($("head"))),this.style_el[0].innerHTML=I.strip_css(this.render_to_css()||""),this._user_page||(this._user_page=$(".user_page.page_widget")),a=!!((t=this.state.theme.banner_image)!=null&&t.id),this._user_page.toggleClass("has_banner",a),this._user_page.toggleClass("mode_grid",this.state.theme.layout==="grid"),this._user_page.toggleClass("mode_column",this.state.theme.layout==="column"),this._user_page.toggleClass("mode_collection_grid",this.state.theme.collection_layout==="grid"),this._user_page.toggleClass("mode_show_purchases",!!this.state.theme.show_purchases),a&&(this._user_header_image||(this._user_header_image=$("#profile_header .profile_banner")),this.state.banner_image&&this._user_header_image.attr("src",this.state.banner_image.thumb_url)),this.props.can_use_css&&(this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head"))),this.custom_style_el[0].innerHTML=I.strip_css(this.state.theme.css||"")),this.load_font(this.state.theme.font_family)},apply_project_order:function(){var a,t,e,p,g,y,x,N,z,L,B,F;for(g=this._user_page.find(".user_game_grid"),t={},e=function(){var T,A,P,D;for(P=g.children(".game_cell"),D=[],T=0,A=P.length;T<A;T++)a=P[T],y=parseInt($(a).data("game_id")),t[y]=a,D.push(y);return D}(),x=this.state.theme.game_order||e,N=this.state.theme.hidden_games||[],F=[],z=0,B=x.length;z<B;z++)L=x[z],p=t[L],p&&(p.style.display=yt.call(N,L)>=0?"none":"",F.push(g.append(p)));return F},apply_collection_order:function(){var a,t,e,p,g,y,x,N,z,L,B,F;for(e=this._user_page.find(".collections"),F={},p=function(){var T,A,P,D;for(P=e.children(".collection_row"),D=[],T=0,A=P.length;T<A;T++)B=P[T],a=parseInt($(B).data("collection_id")),F[a]=B,D.push(a);return D}(),t=this.state.theme.collection_order||p,y=this.state.theme.hidden_collections||[],L=[],x=0,z=t.length;x<z;x++)N=t[x],g=F[N],g&&(g.style.display=yt.call(y,N)>=0?"none":"",L.push(e.append(g)));return L},load_font:function(a){var t;if(this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts)),!this.loaded_fonts[a]&&(this.loaded_fonts[a]=!0,t=this.state.fonts.find(function(e){return e.slug===a}),!!t&&t.href&&!$("link[data-font='"+t.slug+"']").exists()))return $("<link rel='stylesheet' href='"+t.href+"' data-font='"+t.slug+"'></link>").appendTo("head")},render:function(){return React.createElement(i,{key:"transition_group",component:"span"},this.state.open?React.createElement(o,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({key:"real",className:"theme_editor_widget"},f({},"You can edit your profile's content on your ",b({href:this.props.user_settings_url,target:"_blank"},"account profile settings"),"."),c({ref:this.form_ref||(this.form_ref=React.createRef()),method:"POST",onSubmit:function(a){return function(t){var e;return t.preventDefault(),e=JSON.stringify(a.state.theme),a.setState({loading:!0}),$.ajax({url:a.props.submit_url,type:"POST",data:I.with_csrf({theme:e}),xhrFields:{withCredentials:!0},error:function(p){return a.setState({loading:!1}),U(rt({errors:["Server error"],sub_text:"Your changes were not saved, please try again"}))},success:function(p){if(a.setState({loading:!1}),p.errors)return U(rt({errors:p.errors,sub_text:"Your changes were not saved, please try again"}))}})}}(this)},this.render_color_pickers(),this.render_text_settings(),this.render_images(),this.render_project_settings(),this.render_collection_order(),this.render_css_editor(),s({className:"buttons save_buttons"},n({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||!1},this.state.loading&&"Saving..."||"Save"))))},color_input:function(a,t){var e;return t==null&&(t={}),G({popout_portal_target:document.body,className:"compact",value:this.state.theme[a],allow_empty:t.allow_empty,onChange:this[e="set_"+a]||(this[e]=function(p){return function(g){return g===""&&(g=void 0),p.update_theme(a,g)}}(this))})},render_css_editor:function(){if(this.props.can_use_css)return h({className:"input_group css_editor"},m({},"Misc"),w.ThemeEditor.CssEditor({value:this.state.theme.css||"",css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(a){return function(t){return a.update_theme("css",t.target.value)}}(this))}))},render_color_pickers:function(){return h({className:"input_group"},m({},"Color"),u({className:"horiz_input"},v({className:"label_text"},"BG"),this.color_input("bg_color")),u({className:"horiz_input"},v({className:"label_text"},"Text"),this.color_input("text_color")),u({className:"horiz_input"},v({className:"label_text"},"Link"),this.color_input("link_color")))},render_text_settings:function(){var a;return h({className:"input_group"},m({},"Text"),u({className:"horiz_input"},v({className:"label_text"},"Font"),w.ThemeEditor.FontSelect({fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font||(this.append_font=function(t){return function(e){return t.setState({fonts:bt.call(t.state.fonts).concat([e])})}}(this)),value:this.state.theme.font_family||"",on_pick_family:this.set_font_family||(this.set_font_family=function(t){return function(e){return t.update_theme("font_family",e)}}(this))})),u({className:"horiz_input"},v({className:"label_text"},"Size"),X({min:75,max:175,show_tooltip:!0,value:(a=this.state.theme.font_size)!=null?a:100,onChange:this.set_font_size||(this.set_font_size=function(t){return function(e){return t.update_theme("font_size",e)}}(this))})))},render_images:function(){var a;return h({className:"input_group"},m({},"Images"),q({compact:!0,upload_url:this.props.image_upload_url,max_size:this.props.image_size_limit,upload:this.state.banner_image,label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(t){return function(e){return t.setState({banner_image:e}),t.update_theme("banner_image",Object.assign({},t.state.theme.banner_image||{size:"fixed"},{id:e!=null?e.id:void 0}))}}(this))},this.state.banner_image?s({className:"position_fields"},u({className:"horiz_input"},v({className:"label_text"},"Size"),w.Forms.SimpleSelect({value:((a=this.state.theme.banner_image)!=null?a.size:void 0)||"",onChange:this.set_banner_image_size||(this.set_banner_image_size=function(t){return function(e){return t.update_theme("banner_image",Object.assign({},t.state.theme.banner_image||{},{size:e}))}}(this)),options:this.banner_image_size_options||(this.banner_image_size_options=[{name:"Fixed width ",value:"fixed"},{name:"Full width",value:"full"}])}))):void 0),w.ThemeEditor.BackgroundImageUploader({image_upload_url:this.props.image_upload_url,max_size:this.props.image_size_limit,upload:this.state.background_image,params:this.state.theme.background_image,on_change:function(t){return function(e,p){return t.update_theme("background_image",p),t.setState({background_image:e})}}(this)}))},render_project_settings:function(){var a;if(this.props.games&&this.props.games.length)return h({className:"input_group project_input_group"},m({},"My Projects"),u({className:"horiz_input"},v({className:"label_text"},"Layout"),w.Forms.SimpleSelect({value:this.state.theme.layout||"",onChange:this.set_layout||(this.set_layout=function(t){return function(e){return t.update_theme("layout",e)}}(this)),options:this.layout_options||(this.layout_options=[{name:"Sidebar",value:"column"},{name:"Grid",value:"grid"}])})),u({className:"horiz_input"},v({className:"label_text"},"B. Radius"),X({min:0,max:150,show_tooltip:!0,value:(a=this.state.theme.border_radius)!=null?a:0,onChange:this.set_border_radius||(this.set_border_radius=function(t){return function(e){return t.update_theme("border_radius",e)}}(this))})),w.ThemeEditor.OrderPicker({items:this.props.games,update_order:this.set_game_order||(this.set_game_order=function(t){return function(e){var p;return t.setState({theme:Object.assign({},t.state.theme,{game_order:function(){var g,y,x;for(x=[],g=0,y=e.length;g<y;g++)p=e[g],x.push(p.id);return x}(),hidden_games:function(){var g,y,x;for(x=[],g=0,y=e.length;g<y;g++)p=e[g],p.hidden&&x.push(p.id);return x}()})})}}(this))}))},render_collection_order:function(){if(this.props.collections&&this.props.collections.length)return h({className:"input_group collection_input_group"},m({},"Collections"),u({className:"horiz_input"},v({className:"label_text"},"Layout"),w.Forms.SimpleSelect({value:this.state.theme.collection_layout||"",onChange:this.set_collection_layout||(this.set_collection_layout=function(a){return function(t){return a.update_theme("collection_layout",t)}}(this)),options:this.collection_layout_options||(this.collection_layout_options=[{name:"List",value:"list"},{name:"Grid",value:"grid"}])})),u({className:"horiz_input wide_label"},v({className:"label_text"},"Supported by me"),s({},d({type:"checkbox",checked:this.state.theme.show_purchases||!1,onChange:this.set_show_purchases||(this.set_show_purchases=function(a){return function(t){return a.update_theme("show_purchases",t.target.checked)}}(this))}))),w.ThemeEditor.OrderPicker({items:this.props.collections,update_order:this.set_collection_order||(this.set_collection_order=function(a){return function(t){var e;return a.setState({theme:Object.assign({},a.state.theme,{collection_order:function(){var p,g,y;for(y=[],p=0,g=t.length;p<g;p++)e=t[p],y.push(e.id);return y}(),hidden_collections:function(){var p,g,y;for(y=[],p=0,g=t.length;p<g;p++)e=t[p],e.hidden&&y.push(e.id);return y}()})})}}(this))}))}})});var St={}.hasOwnProperty,Ct=[].slice,xt=null;M(function(){var o,r,i,l,b,n,s,c,m,d,u,f,h,v,a,t,e;return i=E,h=i.select,u=i.li,n=i.button,v=i.span,b=i.br,l=i.a,m=i.h2,s=i.div,c=i.form,d=i.input,f=i.p,e=i.ul,r=R.package("ThemeEditor"),t=PropTypes,a=function(p){return function(g){return g.stopPropagation()}}(this),o=function(p){var g,y;return g=p.font,y=p.select_font,u({},n({onClick:y,type:"button","data-family":g.family},v({},v({className:"family_name"},g.family),b({}),v({className:"category"},g.category)),l({href:"https://fonts.google.com/specimen/"+g.family,target:"_blank",onClick:a},"preview")))},o=React.createElement.bind(null,React.memo(o)),xt=r("FontPickerLightbox",{getInitialState:function(p){return function(){return{loading_fonts:!0,filter_category:"all"}}}(this),render:function(){var p;return R.Lightbox({className:"font_picker_lightbox_widget compact"},m({},"Select a font"),s({className:"form"},s({className:"font_filter"},d({type:"text",value:this.state.filter||"",onChange:function(g){return function(y){var x;return x=y.currentTarget.value,$.trim(x)===""&&(x=null),g.reset_scroll(),g.setState({filter:x})}}(this),placeholder:"Search for font by name..."}),R.Forms.SimpleSelect({value:this.state.filter_category,onChange:function(g){return function(y){return g.reset_scroll(),g.setState({filter_category:y})}}(this),options:[{name:"All fonts",value:"all"}].concat(Ct.call(function(){var g,y;g=this.state.font_categories||[],y=[];for(p in g)St.call(g,p)&&y.push({name:p,value:p});return y}.call(this)))})),this.render_font_list(),f({className:"google_fonts"},"These fonts are pulled from Google Fonts, consider ",l({href:"https://fonts.google.com/",target:"_blank"},"using their directory")," and typing the font name here.")))},reset_scroll:function(){if(this.refs.scroller)return this.refs.scroller.scrollTop=0},select_font:function(p){var g,y;if(y=p.currentTarget,!$(y).is("[href]"))return typeof(g=this.props).on_pick_font=="function"?g.on_pick_font(y.dataset.family):void 0},render_font_list:function(){var p,g,y;return this.state.loading_fonts?f({className:"loading"},"Loading list..."):(y=this.state.filter?new RegExp("\\b"+I.escape_regex($.trim(this.state.filter)),"i"):void 0,g=function(x){return function(N){return x.state.filter_category!=="all"&&N.category!==x.state.filter_category?!1:x.state.filter?N.family===x.state.filter?!0:y.test(N.family):!0}}(this),p=this.state.fonts.filter(g).map(function(x){return function(N){return o({key:N.family,select_font:x.select_font,font:N})}}(this)),e({className:"font_list",ref:"scroller"},p.length?p:u({className:"empty_search"},"No results found")))},componentDidMount:function(){var p;return p=this.props.fonts?$.when(this.props.fonts):$.getJSON(this.props.fonts_url),p.then(function(g){return function(y){var x,N,z,L;for(N={},z=0,L=y.length;z<L;z++)x=y[z],N[x.category]||(N[x.category]=0),N[x.category]+=1;return g.setState({loading_fonts:!1,font_categories:N,fonts:y})}}(this))}})});var zt=[].slice;M(function(){var o,r,i,l,b,n,s,c,m,d,u,f;return r=E,i=r.button,c=r.label,b=r.fieldset,m=r.legend,l=r.div,d=r.select,n=r.fragment,f=r.textarea,s=r.input,u=r.span,n=React.createElement.bind(null,React.Fragment),n.type=React.fragment,o=w.package("ThemeEditor"),o.escape_font_family=function(h){return h.match(/ /)?"'"+h+"'":h},o.background_css=function(h,v){var a;return h?(a=function(){switch(v.position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}(),_.compact(["background-image: url('"+h.thumb_url+"')","background-repeat: "+(v.repeat||"repeat"),"background-position: "+a,v.attach==="fixed"?"background-attachment: fixed":void 0]).join(";")):""},o("MoreGroup",{pure:!0,getInitialState:function(){return{open:!!this.props.default_open}},render_toggle:function(){return i({type:"button",className:"toggle_button",onClick:function(h){return function(){return h.setState({open:!h.state.open})}}(this)},this.props.label)},render:function(){return this.enclose({className:classNames("more_group",{open:this.state.open})},b({style:{display:this.state.open?"":"none"}},m({},this.render_toggle()),l({className:"more_children"},this.props.children)),this.state.open?void 0:this.render_toggle())}}),o("FontSelect",{pure:!0,propTypes:{fonts:k.array.isRequired,fonts_url:k.string.isRequired,allow_default:k.bool},open_google_fonts:function(){return U(xt({fonts_url:this.props.fonts_url,on_pick_font:function(h){return function(v){var a,t,e,p,g,y;if(I.Lightbox.close(),y=v,t=h.props.fonts.find(function(x){return x.slug===y}),t){typeof(a=h.props).on_pick_family=="function"&&a.on_pick_family(v);return}return e={slug:y,name:v,family:v,type:"google_font",href:"https://fonts.googleapis.com/css?"+$.param({family:v+":400,400italic,700,700italic"})},(p=h.props)!=null&&p.on_add_font(e),(g=h.props)!=null?g.on_pick_family(e.family):void 0}}(this)}))},render:function(){var h;return w.Forms.SimpleSelect({name:this.props.name,value:this.props.value,onChange:function(v){return function(a){return a==="_select_google_font"?v.open_google_fonts():v.props.on_pick_family(a)}}(this),options:_.compact([this.props.allow_default?{name:"Default font",value:"_default"}:void 0,{name:"Select Google Font...",value:"_select_google_font"}].concat(zt.call(function(){var v,a,t,e;for(t=this.props.fonts,e=[],v=0,a=t.length;v<a;v++)h=t[v],e.push({name:h.name,value:h.slug,group:"Fonts"});return e}.call(this))))})}}),o("CssEditor",{pure:!0,render:function(){return n({},l({className:"label_help"},c({},l({className:"label_text"},"Custom CSS")),i({type:"button",className:"maximize_button textlike",title:"Expand",onClick:function(h){return function(v){return U(ft({default_value:h.props.value,on_change:h.props.on_change,css_guide_url:h.props.css_guide_url}))}}(this)},"\u2197"),i({type:"button",className:"button small outline",onClick:function(h){return function(v){return U(nt({css_guide_url:h.props.css_guide_url}))}}(this)},"Readme")),f({name:this.props.name,value:this.props.value,onChange:this.props.on_change}))}}),o("BackgroundImageUploader",{pure:!0,getDefaultProps:function(){return{default_params:{repeat:"repeat",position:"align_center"}}},propTypes:{input_name_prefix:k.string,image_upload_url:k.string.isRequired,upload:k.object,on_change:k.func,params:k.object},update_params:function(h){var v,a;return a=Object.assign({},this.props.params||{},h),typeof(v=this.props).on_change=="function"?v.on_change(this.props.upload,a):void 0},render:function(){var h,v,a;return q({compact:!0,upload_url:this.props.image_upload_url,upload:this.props.upload,name:this.props.input_name_prefix?this.props.input_name_prefix+"[image_id]":void 0,label:"Background",upload_label:"Upload",on_upload:this.props.on_change?this.on_upload||(this.on_upload=function(t){return function(e){var p,g;return g=Object.assign({},t.props.params||t.props.default_params,{id:e!=null?e.id:void 0}),typeof(p=t.props).on_change=="function"?p.on_change(e,g):void 0}}(this)):void 0},this.props.upload?l({className:"position_fields"},c({className:"horiz_input"},u({className:"label_text"},"Repeat"),w.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[repeat]":void 0,value:(h=this.props.params)!=null?h.repeat:void 0,onChange:this.props.on_change?this.set_repeat||(this.set_repeat=function(t){return function(e){return t.update_params({repeat:e})}}(this)):void 0,options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),c({className:"horiz_input"},u({className:"label_text"},"Align"),w.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[position]":void 0,value:(v=this.props.params)!=null?v.position:void 0,onChange:this.props.on_change?this.set_position||(this.set_position=function(t){return function(e){return t.update_params({position:e})}}(this)):void 0,options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])})),c({className:"horiz_input"},u({className:"label_text"},"Fixed"),l({},s({type:"checkbox",name:this.props.input_name_prefix?this.props.input_name_prefix+"[attach]":void 0,value:"fixed",checked:((a=this.props.params)!=null?a.attach:void 0)==="fixed",onChange:this.props.on_change?this.set_attach||(this.set_attach=function(t){return function(e){var p;return p=e.target.checked?"fixed":null,t.update_params({attach:p})}}(this)):void 0})))):void 0)}})})})();
